import{x as De,C as he,J as Me,K as me,$ as ce,r as t,M as oe,z as v,A as T,d as _,j as s,o as vt,F as we,y as Be,N as Ae,a0 as Ot,a1 as Ft,w as Pt,T as Ne,B as Ze,E as xt,Q as be,s as _t}from"./index-Db1G4GFK.js";import{u as b,s as R,z as u,t as $e,h as Ce,D as wt,P as Mt}from"./SnackbarDefaults-bH2yLHx5.js";import{C as Bt,a as $t,b as kt}from"./CustomSelectField-BK9WybEE.js";import{S as se,C as de,b as Gt,m as Vt,c as ut,a as dt,u as Ht,F as qt}from"./CustomFormDialog-CJNVvg9u.js";import{u as ft,C as ge,a as jt,b as We}from"./BusinessPhasesApi-IBxa8BZM.js";import{d as ht}from"./ShiftsApi-CqFIuQVz.js";import{C as zt}from"./CustomDatePickerField-CncB9y7f.js";import{u as Yt,a as Qt,b as Kt,B as Xt}from"./RolesApi-C49UzPy3.js";import"./ListSubheader-CyAfKHC_.js";import"./InputAdornment-B4lIQZ4Z.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new Error().stack;r&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[r]="07b347c2-9f68-47b2-9310-cea2d7f9050d",o._sentryDebugIdIdentifier="sentry-dbid-07b347c2-9f68-47b2-9310-cea2d7f9050d")}catch{}})();const Wt=()=>[{key:"id",title:"ID",canBeSorted:!0},{key:"email",title:"EMAIL",canBeSorted:!0},{key:"name",title:"NAME",canBeSorted:!0},{key:"surname",title:"SURNAME",canBeSorted:!0},{key:"phaseName",title:"PHASE",canBeSorted:!0},{key:"shiftName",title:"SHIFT",canBeSorted:!0},{key:"lastLogin",title:"LAST_LOGIN",canBeSorted:!0},{key:"area",title:"AREA",canBeSorted:!0},{key:"delegate",title:"DELEGATE",canBeSorted:!0},{key:"escalationManager",title:"BU_MANAGER",canBeSorted:!0}],gt=o=>{const{control:r,errors:a,filter:l,setValue:n,phaseId:L}=o,A=De(),S=b(he);b(Me);const I=b(me),D=b(ce),[g,d]=t.useState(),[h,q]=t.useState(),[O,z]=t.useState({businessId:1,pageSize:oe,sortBy:"name",sortOrder:se.ASCENDING,page:1}),K=ft(O),[Q,ne]=t.useState([]),[Y,F]=t.useState(0),[k,P]=t.useState({businessId:1,pageSize:oe,sortBy:"name",sortOrder:se.ASCENDING,page:1,businessPhaseId:1}),[B,X]=t.useState(!0),W=ht(k,{refetchOnMountOrArgChange:!0,skip:B}),[G,le]=t.useState([]),[ue,ae]=t.useState(0);t.useEffect(()=>{L&&L.value!=0&&d(L)},[L]),t.useEffect(()=>{const{isSuccess:m,data:E,isLoading:w,isFetching:fe,isError:ie,error:re}=W;if(A(v(w)),A(v(fe)),m&&E){const{data:ee,totalCount:J}=E,te=ee.map(Z=>({label:Z.name,value:Z.id}));le([...te]),ae(Z=>k.filter?Z:J)}ie&&re&&A(T(R(`${S.t("ERROR_LOADING_DATA")} ${I.t("SHIFT")}`,"error")))},[W]),t.useEffect(()=>{const{isSuccess:m,data:E,isLoading:w,isFetching:fe,isError:ie,error:re}=K;if(A(v(w)),A(v(fe)),m&&E){const{data:ee,totalCount:J}=E;ee.map(te=>{Q.filter(Z=>Z.value==te.id).length===0&&ne(Z=>[...Z,{label:te.name,value:te.id}])}),F(te=>O.filter?te:J)}ie&&re&&A(T(R(`${S.t("ERROR_LOADING_DATA")} ${I.t("BUSINESS_PHASES")}`,"error")))},[K]);const N=()=>{Q.length<Y&&z(m=>({...m,page:m.page+1,filter:void 0}))},p=()=>{G.length<ue&&P(m=>({...m,page:m.page+1,filter:void 0}))},x=m=>{m&&setTimeout(()=>z(E=>({...E,filter:m})),500)},V=m=>{m&&setTimeout(()=>P(E=>({...E,filter:m})),500)};return t.useEffect(()=>{g?(X(!1),P(m=>({...m,businessPhaseId:g.value}))):g===null&&(X(!0),le([]),q(null),n("shiftId",void 0)),g&&h&&Object.keys(g).length&&Object.keys(h).length&&(q(null),n("shiftId",void 0))},[g]),_(vt,{children:[s(de,{control:r,name:"employeeId",label:D.t("EMPLOYEE_ID"),errors:a,InputLabelProps:{shrink:!0},filter:l,placeholder:D.t("EMPLOYEE_ID")}),s(de,{control:r,name:"email",label:D.t("EMAIL"),errors:a,InputLabelProps:{shrink:!0},filter:l,placeholder:D.t("EMAIL")}),s(de,{control:r,name:"name",label:S.t("NAME"),errors:a,InputLabelProps:{shrink:!0},filter:l,placeholder:S.t("NAME")}),s(ge,{control:r,name:"phaseId",label:S.t("PHASE"),errors:a,filter:l,InputLabelProps:{shrink:!0},selectList:Q,onScrollFunc:N,onInputChange:x,onSelectState:d}),s(ge,{control:r,name:"shiftId",label:I.t("SHIFT"),errors:a,filter:l,InputLabelProps:{shrink:!0},selectList:G,onScrollFunc:p,onInputChange:V,onSelectState:q,selectedState:h})]})},ct=(o,r)=>[{label:"IMPORT_CSV",icon:s(we,{className:"pointer-events-none",size:24,children:"material-outline:file_download"}),handleClick:o},{label:"EXPORT_CSV",icon:s(we,{className:"pointer-events-none",size:24,children:"material-outline:file_download"}),handleClick:r}],Jt=o=>{const{submitFilter:r,fetchArgs:a}=o,l=De(),n=b(he);b(me);const L=b(ce),[A,S]=t.useState(),I={employeeId:"",email:"",name:"",phaseId:null,shiftId:null},D=u.object({employeeId:u.string().optional(),email:u.string().optional(),name:u.string().optional(),phaseId:u.any().optional(),shiftId:u.any().optional()}),g=Be({mode:"onChange",defaultValues:I,resolver:$e(D)}),{control:d,formState:h,handleSubmit:q,setValue:O,getValues:z}=g,{errors:K,isDirty:Q,isValid:ne}=h;return t.useEffect(()=>{if(a){const{name:Y,email:F,employeeId:k,phaseId:P,phaseName:B,shiftId:X,shiftName:W}=a;k&&O("employeeId",k),F&&O("email",F),Y&&O("name",Y),P&&(O("phaseId",{label:B,value:P}),S({label:B,value:P})),X&&O("shiftId",{label:W,value:X})}},[a]),s(Gt,{title:L.t("USER")+" "+n.t("FILTERS"),actions:[{title:n.t("FILTER"),onClick:()=>{const Y=z();r(Y),l(Ae())}}],children:s("div",{className:"flex flex-col",children:s(gt,{control:d,errors:K,filter:!0,setValue:O,phaseId:A})})})},Zt=o=>[{label:"EDIT",icon:s(we,{className:"pointer-events-none",size:24,children:"material-outline:edit"}),iconColor:"success",onClick:o}],es=()=>[{key:"email",title:"EMAIL"},{key:"name",title:"NAME"},{key:"surname",title:"SURNAME"}],ts=o=>{const{control:r,name:a,label:l,errors:n,accept:L,setFile:A,...S}=o,I=Vt({customTextField:{"& input::placeholder":{fontSize:"1rem"},"& input::file-selector-button":{display:"none"}}}),[D,g]=t.useState("mt-12 shrink-0 ");return t.useEffect(()=>(S.dialog?(g(d=>d+"w-full "),S.col2&&g(d=>d+"col-span-4 md:col-span-2 ")):S.double?g(d=>d+"w-[49%] "):S.filter?g(d=>d+"w-1/8 "):g(d=>d+"md:mx-6 w-full md:w-[45%] "),()=>{g("mt-12 shrink-0 ")}),[]),s(Ft,{name:a,control:r,render:({field:d})=>{var h;return s(Ot,{...d,"aria-label":l,classes:{root:I().customTextField},className:D,label:l,id:a,variant:"outlined",error:!!n[a],helperText:((h=n[a])==null?void 0:h.message)||" ",onChange:q=>{var O;return A((O=q.target.files)==null?void 0:O[0])},"aria-required":S.required?"true":"false",InputProps:{endAdornment:s(we,{className:"text-48",size:24,color:"action",children:"material-solid:arrow_drop_down"})},...S})}})},ss=["user/fetchAll","user/fetchOne"],as=Pt.enhanceEndpoints({addTagTypes:ss}).injectEndpoints({endpoints:o=>({getAllUsers:o.query({query:({businessId:r,page:a,pageSize:l,sortBy:n,sortOrder:L,filter:A,employeeId:S,email:I,name:D,phaseId:g,shiftId:d})=>{let h="?";return a&&(h+=`page=${a}&`),l&&(h+=`pageSize=${l}&`),n&&(h+=`sortBy=${n}&`),L&&(h+=`sortOrder=${L}&`),A&&(h+=`filter=${A}&`),S&&(h+=`employeeId=${S}&`),I&&(h+=`email=${I}&`),D&&(h+=`name=${D}&`),g&&(h+=`phaseId=${g}&`),d&&(h+=`shiftId=${d}&`),{url:`/users/getusers/${r}${h}`}},providesTags:["user/fetchAll"]}),getOneUser:o.query({query:r=>({url:`/users/getusersbyid/${r}`}),providesTags:["user/fetchOne"]}),postUser:o.mutation({query:r=>({url:"/users/addusers",method:"POST",data:r}),invalidatesTags:["user/fetchAll"]}),putUser:o.mutation({query:r=>({url:"/users/updateusers",method:"PUT",data:r}),invalidatesTags:["user/fetchAll","user/fetchOne"]}),deleteUser:o.mutation({query:r=>({url:`/users/deleteusers/${r}`,method:"DELETE"}),invalidatesTags:["user/fetchAll"]}),postBulkUserUpload:o.mutation({query:r=>({url:"/users/bulkuserupload",method:"POST",data:r,formData:!0}),invalidatesTags:["user/fetchAll"]}),postAddMultipleUser:o.mutation({query:r=>({url:"/users/addmultipleusers",method:"POST",data:r}),invalidatesTags:["user/fetchAll"]})})}),{useGetOneUserQuery:rs,useGetAllUsersQuery:mt,usePutUserMutation:ns,usePostUserMutation:ls,useDeleteUserMutation:is,usePostBulkUserUploadMutation:os,usePostAddMultipleUserMutation:Ts}=as,cs=o=>{b(me);const r=b(he),a=b(ce),l=De(),{add:n,userId:L}=o,[A,S]=t.useState(!0),[I,D]=t.useState(),[g,d]=os();t.useEffect(()=>(L&&S(!1),()=>S(!0)),[L]);const h={id:void 0,businessId:1,file:null},q=u.object({id:u.number().optional(),businessId:u.number().optional(),file:u.object({name:u.string().optional(),type:u.string().optional(),size:u.number().max(10485760,"File size exceeds 10MB")}).nullable()}),O=Be({mode:"onChange",defaultValues:h,resolver:$e(q)}),{handleSubmit:z,control:K,formState:Q,setValue:ne,reset:Y,getValues:F}=O,{isValid:k,errors:P,isDirty:B}=Q;t.useEffect(()=>{I&&console.log(I)},[I]);const X=G=>{console.log(G.file),Y(h)},W=()=>{if(I){console.log(I);const G=new FormData;G.append("fileData",I),console.log(G.get("fileData")),g(G)}};return t.useEffect(()=>{const{isError:G,isLoading:le,isSuccess:ue,data:ae,error:N}=d;l(v(le)),ue&&ae&&(console.log(ae),setTimeout(()=>{l(T(R(`${a.t("BULK_USER")} ${r.t("UPLOAD_SUCCESSFUL")}`,"success")))},250),l(Ae())),G&&N&&l(T(R(`${r.t("UPLOAD_ERROR")} ${a.t("BULK_USER")}`,"error")))},[d]),_(dt,{isValid:k,isDirty:B,actions:[{title:r.t("Import"),onClick:z(G=>X(G))}],handleSubmit:z(G=>X(G)),title:a.t("BULK_USER_UPLOAD"),children:[_("div",{className:"w-full  mb-8",children:[s(Ne,{component:"h4",className:"flex-1 text-lg md:text-xl font-bold tracking-tight leading-4 sm:leading-7 whitespace-nowrap",children:r.t("SELECT_FILE")}),s(ts,{control:K,name:"file",label:r.t("SELECT_FILE"),errors:P,InputLabelProps:{shrink:!0},dialog:"true",type:"file",setFile:D}),s("div",{className:"flex flex-row justify-end px-12 mb-8",children:s(Ze,{className:"rounded-md py-16 mb-12 lg:w-1/2 w-full",color:"secondary",variant:"contained",onClick:W,children:s("span",{className:"mx-48 whitespace-nowrap",children:r.t("UPLOAD")})})})]}),_("div",{className:"w-full mb-48",children:[s("div",{className:"w-full flex my-8",children:s(Ne,{component:"h4",className:"flex-1 text-lg md:text-xl font-bold tracking-tight leading-4 sm:leading-7 whitespace-nowrap",children:r.t("PREVIEW")})}),s(ut,{showId:!0,tableLabel:a.t("USERS"),tableHeadings:es(),t:a.t})]})]})},us=()=>[{key:"info",label:"INFO"},{key:"organisation",label:"ORGANISATION"},{key:"audit",label:"AUDIT"}],ds=o=>{const{control:r,errors:a}=o,l=b(ce),n=b(he);return _("div",{className:"mt-12 w-full",children:[_("div",{className:"flex md:gap-12 flex-col md:flex-row",children:[s("div",{className:"flex-1",children:s(de,{control:r,name:"employeeId",label:l.t("EMPLOYEE_ID"),errors:a,InputLabelProps:{shrink:!0},dialog:"true",required:!0})}),s("div",{className:"flex-1",children:s(de,{control:r,name:"name",label:n.t("NAME"),errors:a,InputLabelProps:{shrink:!0},dialog:"true",required:!0})})]}),_("div",{className:"flex md:gap-12 flex-col md:flex-row",children:[s("div",{className:"flex-1",children:s(de,{control:r,name:"email",label:l.t("EMAIL"),errors:a,InputLabelProps:{shrink:!0},dialog:"true",required:!0})}),s("div",{className:"flex-1",children:s(de,{control:r,name:"surname",label:l.t("SURNAME"),errors:a,InputLabelProps:{shrink:!0},dialog:"true",required:!0})})]})]})},fs=o=>{const{control:r,errors:a,phases:l,onPhasesScroll:n,phaseInputChange:L,shifts:A,onShiftsScroll:S,shiftsInputChange:I,categories:D,usersList:g,onUsersListScroll:d,usersListInputChange:h,setSelectedPhase:q,selectedPhase:O,setSelectedShift:z,selectedShift:K,setSelectedDelegateUser:Q,setSelectedEscalationManager:ne,setUserCategoryId:Y,isPhaseShiftDisabled:F}=o,k=b(ce),P=b(he),B=b(Me);return b(me),_("div",{className:"mt-12 w-full lg:w-[25vw]",children:[_("div",{className:"flex gap-12 flex-row",children:[s("div",{className:"flex-1",children:s(de,{control:r,name:"area",label:k.t("AREA"),errors:a,InputLabelProps:{readOnly:!0,shrink:!0},dialog:"true",required:!0,disabled:!0})}),s("div",{className:"flex-1",children:s(Bt,{control:r,name:"categoryId",label:P.t("CATEGORY"),errors:a,dialog:!0,required:!0,InputLabelProps:{shrink:!0},selectList:D,onSelectState:Y})})]}),_("div",{className:"flex gap-12 flex-row",children:[s("div",{className:"flex-1",children:s(ge,{control:r,name:"phaseId",label:P.t("PHASE"),errors:a,filter:!0,required:!0,InputLabelProps:{shrink:!0},disableClearable:!0,selectList:l,onScrollFunc:n,onInputChange:L,onSelectState:q,selectedState:O,disabled:F})}),s("div",{className:"flex-1",children:s(ge,{control:r,name:"shiftId",label:B.t("SHIFT"),errors:a,filter:!0,InputLabelProps:{shrink:!0},disableClearable:!0,selectList:A,onScrollFunc:S,onInputChange:I,onSelectState:z,selectedState:K,required:!0,disabled:F})})]}),s("div",{className:"flex gap-12 flex-row",children:s("div",{className:"flex-1",children:s(zt,{control:r,name:"startDate",label:P.t("START_DATE")+" *",errors:a,slotProps:{textField:{InputLabelProps:{shrink:!0}}},filter:"true"})})}),_("div",{className:"flex md:gap-12 flex-col md:flex-row",children:[s("div",{className:"flex-1",children:s(ge,{control:r,name:"delegateUserId",label:k.t("DELEGATE"),errors:a,filter:!0,InputLabelProps:{shrink:!0},selectList:g,onScrollFunc:d,onInputChange:h,onSelectState:Q})}),s("div",{className:"flex-1",children:s(ge,{control:r,name:"escalationManagerId",label:k.t("BU_MANAGER"),errors:a,filter:!0,InputLabelProps:{shrink:!0},selectList:g,onScrollFunc:d,onInputChange:h,onSelectState:ne})})]})]})},hs=o=>{const{auditData:r,add:a}=o,l=b(ce),[n,L]=t.useState(""),[A,S]=t.useState(""),[I,D]=t.useState("");return t.useEffect(()=>{const g=d=>Ce(d).format("HH:mm MM-DD-YYYY");L(g(r.lastLogin)),S(g(r.created)),D(r.createdBy)},[r]),_("div",{className:"w-full lg:w-[25vw] flex flex-col gap-16 my-16",children:[_(Ne,{children:[s("span",{className:"font-600",children:l.t("LAST_LOGIN")}),": ",a?"":n]}),_(Ne,{children:[s("span",{className:"font-600",children:l.t("CREATED")}),": ",a?"":A]}),_(Ne,{children:[s("span",{className:"font-600",children:l.t("CREATED_BY")}),": ",a?"":I]})]})},Je=o=>{const r=b(me),a=b(he),l=b(ce);b(Me);const n=De(),{add:L,userId:A}=o,[S,I]=t.useState(!0),[D,g]=t.useState(0),d=rs(A,{refetchOnMountOrArgChange:!0,skip:S}),[h,q]=ls(),[O,z]=ns(),[K,Q]=is(),[ne,Y]=t.useState({lastLogin:"",createdBy:"",created:""}),[F,k]=t.useState(),[P,B]=t.useState(),[X,W]=t.useState(),[G,le]=t.useState(),[ue,ae]=t.useState({businessId:1,pageSize:oe,sortBy:"name",sortOrder:se.ASCENDING,page:1}),N=ft(ue),[p,x]=t.useState([]),[V,m]=t.useState(0),[E,w]=t.useState({businessId:1,pageSize:oe,sortBy:"name",sortOrder:se.ASCENDING,page:1}),[fe,ie]=t.useState(!0),re=ht(E,{refetchOnMountOrArgChange:!0,skip:fe}),[ee,J]=t.useState([]),[te,Z]=t.useState(0),[Ue,Le]=t.useState(),[ye,et]=t.useState({businessId:1,pageSize:oe,sortBy:"category",sortOrder:se.ASCENDING,page:1}),Te=Yt(ye),[Re,ke]=t.useState([]),[tt,Ge]=t.useState(0),[ve,Oe]=t.useState({businessId:1,pageSize:oe,sortBy:"name",sortOrder:se.ASCENDING,page:1}),Fe=mt(ve),[Se,Ve]=t.useState([]),[He,qe]=t.useState(0),Pe=Ht("1"),[je,ze]=t.useState(""),[pe,xe]=t.useState(),[Ye,Qe]=t.useState(!0),Ie=Qt(pe,{refetchOnMountOrArgChange:!0,skip:Ye}),st=Kt(void 0,{refetchOnMountOrArgChange:!0}),[St,at]=t.useState([]),[Ke,pt]=t.useState(!0);t.useEffect(()=>(A&&I(!1),()=>I(!0)),[A]);const Xe={id:void 0,employeeId:"",businessId:1,name:"",surname:"",email:"",phaseId:void 0,phaseName:"",shiftId:void 0,shiftName:"",categoryId:0,category:"",initialShiftPart:1,delegateUserId:void 0,escalationManagerId:void 0,area:Xt,startDate:new Date},It=u.object({id:u.number().optional(),businessId:u.number().optional(),employeeId:u.string().min(1).max(256),name:u.string().min(1).max(256),surname:u.string().min(1).max(256),email:u.string().min(1).max(256),phaseId:u.any().refine(e=>e!==void 0,{message:"Phase must be selected"}),phaseName:u.string().optional(),shiftId:u.any().refine(e=>e!==void 0,{message:"Shift must be selected"}),shiftName:u.string().optional(),categoryId:u.number().refine(e=>e!==0&&e!==null&&e!==void 0,{message:"Category must be selected"}),category:u.string().optional(),delegateUserId:u.any(),escalationManagerId:u.any(),initialShiftPart:u.any().optional(),area:u.string().readonly(),startDate:u.date()}),Et=Be({mode:"onChange",defaultValues:Xe,resolver:$e(It)}),{handleSubmit:bt,control:rt,formState:At,setValue:$,reset:Ss,getValues:ps,trigger:_e}=Et,{isValid:nt,errors:lt,isDirty:it}=At;t.useEffect(()=>{pe&&Qe(!1)},[pe]),t.useEffect(()=>{var i;const{data:e,isSuccess:c,isLoading:U,isError:f,error:y}=Ie;if(n(v(U)),c&&e){const j=St.filter(C=>C.value==e.roleId),H=((i=j==null?void 0:j[0])==null?void 0:i.label)!=="General User";pt(H),H?(k(null),B(null),ie(!0),$("shiftId",null),$("phaseId",null),_e("shiftId"),_e("phaseId")):!H&&!F&&!P&&($("phaseId",void 0),$("shiftId",void 0),_e("shiftId"),_e("phaseId"),$("shiftId",null),$("phaseId",null))}f&&y&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${r.t("USER_CATEGORY")}`,"error")))},[Ie]),t.useEffect(()=>{const{data:e,isSuccess:c,isLoading:U,isError:f,error:y}=st;return n(v(U)),c&&e&&e.map(i=>at(j=>{let H=j;return H.push({label:i.name,value:i.id}),H})),f&&y&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${a.t("ROLE")}`,"error"))),()=>at([])},[st]),t.useEffect(()=>{const{data:e,isError:c,isLoading:U,isSuccess:f,error:y}=Pe;n(v(U)),f&&e&&ze(e.area),c&&y&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${r.t("BUSINESS_INFO")}`,"error")))},[Pe]);function Ee(e,c){if(!e&&!c)return"";if(e&&!c)return e;if(e&&c)return e+" "+c}t.useEffect(()=>{const{isSuccess:e,data:c,isLoading:U,isFetching:f,isError:y,error:i}=Fe;if(n(v(U)),n(v(f)),e&&c){const{data:j,totalCount:H}=c;j.map(C=>{Se.filter(M=>M.value==C.id).length===0&&Ve(M=>[...M,{label:Ee(C.name,C.surname),value:C.id}])}),qe(C=>ve.filter?C:H)}y&&i&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${l.t("USERS")}`,"error")))},[Fe]),t.useEffect(()=>{const{isSuccess:e,data:c,isLoading:U,isFetching:f,isError:y,error:i}=Te;if(n(v(U)),n(v(f)),e&&c){const{data:j,totalCount:H}=c;j.map(C=>{Re.filter(M=>M.value==C.id).length===0&&ke(M=>[...M,{label:C.category,value:C.id}])}),Ge(C=>ye.filter?C:H)}y&&i&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${r.t("CATEGORIES")}`,"error")))},[Te]),t.useEffect(()=>{const{isSuccess:e,data:c,isLoading:U,isFetching:f,isError:y,error:i}=re;if(n(v(U)),n(v(f)),e&&c){const{data:j,totalCount:H}=c,C=j.map(M=>({label:M.name,value:M.id}));J([...C]),Z(M=>E.filter?M:H)}y&&i&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${r.t("SHIFT")}`,"error")))},[re]),t.useEffect(()=>{const{isSuccess:e,data:c,isLoading:U,isFetching:f,isError:y,error:i}=N;if(n(v(U)),n(v(f)),e&&c){const{data:j,totalCount:H}=c;j.map(C=>{p.filter(M=>M.value==C.id).length===0&&x(M=>[...M,{label:C.name,value:C.id}])}),m(C=>ue.filter?C:H)}y&&i&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${r.t("BUSINESS_PHASES")}`,"error")))},[N]);const Nt=()=>{p.length<V&&ae(e=>({...e,page:e.page+1,filter:void 0}))},Ct=()=>{ee.length<te&&w(e=>({...e,page:e.page+1,filter:void 0}))},Dt=()=>{Se.length<He&&Oe(e=>({...e,page:e.page+1,filter:void 0}))},Ut=e=>{e&&setTimeout(()=>ae(c=>({...c,filter:e})),500)},Lt=e=>{e&&setTimeout(()=>w(c=>({...c,filter:e})),500)},yt=e=>{e&&setTimeout(()=>Oe(c=>({...c,filter:e})),500)};t.useEffect(()=>{const{data:e,isSuccess:c,isLoading:U,isError:f,error:y}=d;return n(v(U)),c&&e&&($("area",je),Object.keys(e).forEach(i=>{i==="phaseId"?($(i,{value:e[i],label:e.phaseName}),k({value:e[i],label:e.phaseName})):i==="shiftId"?($(i,{value:e[i],label:e.shiftName}),Le(e[i])):i==="categoryId"?($(i,e[i]),xe(e[i])):i==="delegateUserId"?($(i,{value:e[i],label:Ee(e.delegateUserName,e.delegateUserSurname)}),W({value:e[i],label:Ee(e.delegateUserName,e.delegateUserSurname)})):i==="escalationManagerId"?($(i,{value:e[i],label:Ee(e.escalationManagerName,e.escalationManagerSurname)}),le({value:e[i],label:Ee(e.escalationManagerName,e.escalationManagerSurname)})):typeof e[i]=="string"&&Ce(e[i],Ce.ISO_8601).isValid()?$(i,new Date(e[i])):$(i,e[i])}),Y({lastLogin:e.lastLogin,createdBy:e.createdBy,created:e.created})),f&&y&&n(T(R(`${a.t("ERROR_LOADING_DATA")} ${l.t("USER")}`,"error"))),()=>Object.keys(Xe).forEach(i=>$(i,Xe[i]))},[d]),t.useEffect(()=>{console.log(F),F?(ie(!1),w(e=>({...e,businessPhaseId:F.value}))):F===null&&(ie(!0),J([]),B(null),$("shiftId",null)),F&&P&&Object.keys(F).length&&Object.keys(P).length&&(B(null),$("shiftId",null))},[F]),t.useEffect(()=>{if(ee.length>0){const e=ee.filter(c=>c.value===Ue)[0];e&&($("shiftId",e),B(e),Le(null))}else Ue===null&&B(null)},[ee]);const Tt=e=>{L?h(e):O(e)};t.useEffect(()=>{var i,j,H,C,M,ot;const{isError:e,isLoading:c,isSuccess:U,data:f,error:y}=q;n(v(c)),U&&f&&(f.status?(setTimeout(()=>{n(T(R(`${l.t("USER")} ${a.t("ADD_SUCCESSFUL")}`,"success")))},250),n(Ae())):((j=(i=f==null?void 0:f.extraMessage)==null?void 0:i[0])==null?void 0:j.id)==="MAX_USERS_PER_SHIFT_ERROR"?n(T(R(`${l.t("ERROR_EMAIL_MESSAGE")} ${(ot=(M=(C=(H=f==null?void 0:f.extraMessage)==null?void 0:H[0])==null?void 0:C.message)==null?void 0:M[0])==null?void 0:ot.maxUsers}`,"error"))):f.message==="EMAIL_ALREADY_EXISTS"?n(T(R(`${l.t("ERROR_USER_MESSAGE")}`,"error"))):n(T(R(`${a.t("ADD_ERROR")} ${l.t("USER")}`,"error")))),e&&y&&n(T(R(`${a.t("ADD_ERROR")} ${l.t("USER")}`,"error")))},[q]),t.useEffect(()=>{const{isError:e,isLoading:c,isSuccess:U,data:f,error:y}=z;n(v(c)),U&&f&&(setTimeout(()=>{n(T(R(`${l.t("USER")} ${a.t("SAVE_SUCCESSFUL")}`,"success")))},250),n(Ae())),e&&y&&n(T(R(`${a.t("SAVE_ERROR")} ${l.t("USER")}`,"error")))},[z]),t.useEffect(()=>{const{isSuccess:e,isError:c,error:U,isLoading:f}=Q;n(v(f)),e&&(setTimeout(()=>{n(T(R(`${l.t("USER")} ${a.t("DELETE_SUCCESSFUL")}`,"success")))},250),n(Ae())),U&&c&&n(T(R(`${a.t("DELETE_ERROR")} ${l.t("USER")}`,"error")))},[Q]);const Rt=()=>{K(A)};return _(dt,{isValid:nt,isDirty:it,handleSubmit:bt(e=>{var c,U,f,y;return Tt({...e,categoryId:e.categoryId,phaseId:Ke?null:(c=e.phaseId)==null?void 0:c.value,shiftId:Ke?null:(U=e.shiftId)==null?void 0:U.value,delegateUserId:(f=e.delegateUserId)==null?void 0:f.value,delegateUserName:"",delegateUserSurname:"",escalationManagerId:(y=e.escalationManagerId)==null?void 0:y.value,escalationManagerName:"",escalationManagerSurname:"",createdBy:"",lastLogin:"2024-04-01T07:32:47.174"})}),title:`${l.t("USER")}`,children:[s("div",{className:"w-full",children:_(xt,{sx:{width:"100%"},children:[s(jt,{tabValue:D,tabLabel:"user",tabs:us(),handleTabChange:e=>g(e),t:l.t}),s(We,{value:D,index:0,aria:"Info",children:s(ds,{control:rt,errors:lt})}),s(We,{value:D,index:1,aria:"Organisation",children:s(fs,{control:rt,errors:lt,phases:p,onPhasesScroll:Nt,phaseInputChange:Ut,shifts:ee,onShiftsScroll:Ct,shiftsInputChange:Lt,categories:Re,usersList:Se,onUsersListScroll:Dt,usersListInputChange:yt,setSelectedPhase:k,setSelectedShift:B,selectedShift:P,setSelectedDelegateUser:W,setSelectedEscalationManager:le,setUserCategoryId:xe,isPhaseShiftDisabled:Ke,selectedPhase:F})}),s(We,{value:D,index:2,aria:"Audit",children:s(hs,{add:L,auditData:ne})})]})}),_("div",{className:"flex flex-row justify-end items-end w-full gap-12",children:[s("div",{className:"hidden md:flex md:flex-1"}),_("div",{className:"flex flex-1 gap-12",children:[!L&&s("div",{className:"flex-1",children:s(Ze,{className:"rounded-md w-full",color:"secondary",variant:"outlined",onClick:Rt,children:a.t("DELETE")})}),s("div",{className:"flex-1",children:s(Ze,{className:"rounded-md w-full",color:"secondary",variant:"contained",type:"submit",disabled:!(nt&&it),children:a.t("SAVE")})})]})]})]})},gs=()=>{const o=b(ce),r=b(he);b(me),b(Me);const a=De(),[l,n]=t.useState({businessId:1,page:1,pageSize:oe,sortBy:"name",sortOrder:se.ASCENDING}),[L,A]=t.useState(!1),[S,I]=t.useState([]),[D,g]=t.useState({currentPage:1,pageSize:oe,totalCount:0,totalPages:0}),[d,h]=t.useState(0),q=mt(l,{refetchOnMountOrArgChange:!0}),O={employeeId:"",email:"",name:"",phaseId:void 0,shiftId:void 0},z=u.object({employeeId:u.string().optional(),email:u.string().optional(),name:u.string().optional(),phaseId:u.any().optional(),shiftId:u.any().optional()}),K=Be({mode:"onChange",defaultValues:O,resolver:$e(z)}),{control:Q,formState:ne,handleSubmit:Y,setValue:F}=K,{errors:k}=ne;t.useEffect(()=>{const{data:N,isLoading:p,isSuccess:x,isError:V,error:m,isFetching:E}=q;if(a(v(p)),a(v(E)),x&&N){const{totalCount:w,totalPages:fe,currentPage:ie,data:re,pageSize:ee}=N;g(J=>({...J,totalCount:w,totalPages:fe,currentPage:ie,pageSize:ee})),re==null||re.map(J=>{const{id:te,name:Z,surname:Ue,email:Le,employeeId:ye,categoryId:et,category:Te,created:Re,createdBy:ke,delegateUserId:tt,escalationManagerId:Ge,initialShiftPart:ve,lastLogin:Oe,phaseId:Fe,phaseName:Se,shiftId:Ve,shiftName:He,startDate:qe,area:Pe,delegateUserName:je,delegateUserSurname:ze,escalationManagerName:pe,escalationManagerSurname:xe}=J,Ye=P(Oe);I(Qe=>{const Ie=Qe;return Ie.push({id:te,actions:!0,name:Z,surname:Ue,email:Le,employeeId:ye,categoryId:et,category:Te,created:Re,createdBy:ke,delegateUserId:tt,delegate:B(je,ze),escalationManagerId:Ge,escalationManager:B(pe,xe),initialShiftPart:ve,lastLogin:Ye,phaseId:Fe,phaseName:Se,shiftId:Ve,shiftName:He,startDate:qe,area:Pe}),Ie})}),h(J=>l.filter?J:w)}return V&&m&&a(T(R(`${r.t("ERROR_LOADING_DATA")} ${o.t("USERS")}`,"error"))),()=>I([])},[q]);function P(N){const p=Ce(),x=Ce(N);if(x.isAfter(p))return"Never";const V=p.diff(x,"years"),m=p.diff(x,"months");if(V===0&&m===0){const E=p.diff(x,"days");if(E<1){const w=p.diff(x,"hours");return w<1?"A few minutes ago":w===1?"An hour ago":w+" hours ago"}else{if(E===1)return"Yesterday";if(E<7)return E+" days ago";{const w=p.diff(x,"weeks");return w===1?"A week ago":w+" weeks ago"}}}else return V===1?"A year ago":V>1?V+" years ago":"Never"}function B(N,p){if(!N&&!p)return"";if(N&&!p)return N;if(N&&p)return N+" "+p}t.useEffect(()=>{A(d>oe)},[d]);const X=()=>{a(be({children:s(cs,{})}))},W=()=>alert("Work in progress"),G=N=>{const{id:p}=N.target;a(be({children:s(Je,{add:!1,userId:p})}))},le=(N,p)=>{n(x=>({...x,page:p+1}))},ue=(N,p)=>{n(x=>{let V;return x.sortBy===p?x.sortOrder===se.ASCENDING?V=se.DESCENDING:V=se.ASCENDING:V=se.ASCENDING,{...x,sortBy:p,sortOrder:V}})},ae=N=>{const{name:p,employeeId:x,email:V,phaseId:m,shiftId:E}=N;n(w=>({...w,name:p,email:V,employeeId:x,shiftId:E==null?void 0:E.value,shiftName:E==null?void 0:E.label,phaseId:m==null?void 0:m.value,phaseName:m==null?void 0:m.label}))};return _(kt,{title:o.t("USER_FILTERS"),hasFilterButton:!0,hasAddButton:!0,handleClick:()=>a(be({children:s(Je,{add:!0})})),handleFilterClick:()=>a(be({children:s(Jt,{fetchArgs:l,submitFilter:ae})})),customActionButtons:ct(X,W),children:[s($t,{hasAddButton:!0,handleFilterClick:Y(N=>{ae(N)}),handleAddClick:()=>a(be({children:s(Je,{add:!0})})),customActionButtons:ct(X,W),customActionClass:{parent:"xl:col-span-6 col-span-5 justify-end",filter:""},children:s(gt,{control:Q,errors:k,filter:!0,setValue:F})}),s(ut,{sortBy:l==null?void 0:l.sortBy,sortOrder:l==null?void 0:l.sortOrder,showId:!0,tableLabel:o.t("USERS"),tableHeadings:Wt(),t:o.t,hasActions:!0,tableActions:Zt(G),tableInfo:D,tableRows:S,handlePageChange:le,handleSortChange:ue,hasFilterButton:L})]})},ms=_t(qt)(({theme:o})=>({...wt(o)})),Rs=()=>{const{t:o}=b(ce);return s(ms,{header:s(Mt,{title:o("TITLE")}),scroll:"page",content:s(gs,{})})};export{Rs as default};
//# sourceMappingURL=User-Mb3L1B0h.js.map
